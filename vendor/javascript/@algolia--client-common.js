// @algolia/client-common@5.17.0 downloaded from https://ga.jspm.io/npm:@algolia/client-common@5.17.0/dist/common.js

function createBrowserLocalStorageCache(e){let t;const r=`algolia-client-js-${e.key}`;function getStorage(){t===void 0&&(t=e.localStorage||window.localStorage);return t}function getNamespace(){return JSON.parse(getStorage().getItem(r)||"{}")}function setNamespace(e){getStorage().setItem(r,JSON.stringify(e))}function removeOutdatedCacheItems(){const t=e.timeToLive?e.timeToLive*1e3:null;const r=getNamespace();const s=Object.fromEntries(Object.entries(r).filter((([,e])=>e.timestamp!==void 0)));setNamespace(s);if(!t)return;const a=Object.fromEntries(Object.entries(s).filter((([,e])=>{const r=(new Date).getTime();const s=e.timestamp+t<r;return!s})));setNamespace(a)}return{get(e,t,r={miss:()=>Promise.resolve()}){return Promise.resolve().then((()=>{removeOutdatedCacheItems();return getNamespace()[JSON.stringify(e)]})).then((e=>Promise.all([e?e.value:t(),e!==void 0]))).then((([e,t])=>Promise.all([e,t||r.miss(e)]))).then((([e])=>e))},set(e,t){return Promise.resolve().then((()=>{const s=getNamespace();s[JSON.stringify(e)]={timestamp:(new Date).getTime(),value:t};getStorage().setItem(r,JSON.stringify(s));return t}))},delete(e){return Promise.resolve().then((()=>{const t=getNamespace();delete t[JSON.stringify(e)];getStorage().setItem(r,JSON.stringify(t))}))},clear(){return Promise.resolve().then((()=>{getStorage().removeItem(r)}))}}}function createNullCache(){return{get(e,t,r={miss:()=>Promise.resolve()}){const s=t();return s.then((e=>Promise.all([e,r.miss(e)]))).then((([e])=>e))},set(e,t){return Promise.resolve(t)},delete(e){return Promise.resolve()},clear(){return Promise.resolve()}}}function createFallbackableCache(e){const t=[...e.caches];const r=t.shift();return r===void 0?createNullCache():{get(e,s,a={miss:()=>Promise.resolve()}){return r.get(e,s,a).catch((()=>createFallbackableCache({caches:t}).get(e,s,a)))},set(e,s){return r.set(e,s).catch((()=>createFallbackableCache({caches:t}).set(e,s)))},delete(e){return r.delete(e).catch((()=>createFallbackableCache({caches:t}).delete(e)))},clear(){return r.clear().catch((()=>createFallbackableCache({caches:t}).clear()))}}}function createMemoryCache(e={serializable:true}){let t={};return{get(r,s,a={miss:()=>Promise.resolve()}){const o=JSON.stringify(r);if(o in t)return Promise.resolve(e.serializable?JSON.parse(t[o]):t[o]);const n=s();return n.then((e=>a.miss(e))).then((()=>n))},set(r,s){t[JSON.stringify(r)]=e.serializable?JSON.stringify(s):s;return Promise.resolve(s)},delete(e){delete t[JSON.stringify(e)];return Promise.resolve()},clear(){t={};return Promise.resolve()}}}var e=1e3;var t=2e3;var r=3e4;var s=2e3;var a=5e3;var o=3e4;function createAlgoliaAgent(e){const t={value:`Algolia for JavaScript (${e})`,add(e){const r=`; ${e.segment}${e.version!==void 0?` (${e.version})`:""}`;t.value.indexOf(r)===-1&&(t.value=`${t.value}${r}`);return t}};return t}function createAuth(e,t,r="WithinHeaders"){const s={"x-algolia-api-key":t,"x-algolia-application-id":e};return{headers(){return r==="WithinHeaders"?s:{}},queryParameters(){return r==="WithinQueryParameters"?s:{}}}}function createIterablePromise({func:e,validate:t,aggregator:r,error:s,timeout:a=(()=>0)}){const retry=o=>new Promise(((n,i)=>{e(o).then((async e=>{r&&await r(e);return await t(e)?n(e):s&&await s.validate(e)?i(new Error(await s.message(e))):setTimeout((()=>{retry(e).then(n).catch(i)}),await a())})).catch((e=>{i(e)}))}));return retry()}function getAlgoliaAgent({algoliaAgents:e,client:t,version:r}){const s=createAlgoliaAgent(r).add({segment:t,version:r});e.forEach((e=>s.add(e)));return s}function createNullLogger(){return{debug(e,t){return Promise.resolve()},info(e,t){return Promise.resolve()},error(e,t){return Promise.resolve()}}}var n=12e4;function createStatefulHost(e,t="up"){const r=Date.now();function isUp(){return t==="up"||Date.now()-r>n}function isTimedOut(){return t==="timed out"&&Date.now()-r<=n}return{...e,status:t,lastUpdate:r,isUp:isUp,isTimedOut:isTimedOut}}var i=class extends Error{name="AlgoliaError";constructor(e,t){super(e);t&&(this.name=t)}};var c=class extends i{stackTrace;constructor(e,t,r){super(e,r);this.stackTrace=t}};var l=class extends c{constructor(e){super("Unreachable hosts - your application id may be incorrect. If the error persists, please reach out to the Algolia Support team: https://alg.li/support.",e,"RetryError")}};var u=class extends c{status;constructor(e,t,r,s="ApiError"){super(e,r,s);this.status=t}};var m=class extends i{response;constructor(e,t){super(e,"DeserializationError");this.response=t}};var h=class extends u{error;constructor(e,t,r,s){super(e,t,s,"DetailedApiError");this.error=r}};function shuffle(e){const t=e;for(let r=e.length-1;r>0;r--){const s=Math.floor(Math.random()*(r+1));const a=e[r];t[r]=e[s];t[s]=a}return t}function serializeUrl(e,t,r){const s=serializeQueryParameters(r);let a=`${e.protocol}://${e.url}${e.port?`:${e.port}`:""}/${t.charAt(0)==="/"?t.substring(1):t}`;s.length&&(a+=`?${s}`);return a}function serializeQueryParameters(e){return Object.keys(e).filter((t=>e[t]!==void 0)).sort().map((t=>`${t}=${encodeURIComponent(Object.prototype.toString.call(e[t])==="[object Array]"?e[t].join(","):e[t]).replace(/\+/g,"%20")}`)).join("&")}function serializeData(e,t){if(e.method==="GET"||e.data===void 0&&t.data===void 0)return;const r=Array.isArray(e.data)?e.data:{...e.data,...t.data};return JSON.stringify(r)}function serializeHeaders(e,t,r){const s={Accept:"application/json",...e,...t,...r};const a={};Object.keys(s).forEach((e=>{const t=s[e];a[e.toLowerCase()]=t}));return a}function deserializeSuccess(e){try{return JSON.parse(e.content)}catch(t){throw new m(t.message,e)}}function deserializeFailure({content:e,status:t},r){try{const s=JSON.parse(e);return"error"in s?new h(s.message,t,s.error,r):new u(s.message,t,r)}catch{}return new u(e,t,r)}function isNetworkError({isTimedOut:e,status:t}){return!e&&~~t===0}function isRetryable({isTimedOut:e,status:t}){return e||isNetworkError({isTimedOut:e,status:t})||~~(t/100)!==2&&~~(t/100)!==4}function isSuccess({status:e}){return~~(e/100)===2}function stackTraceWithoutCredentials(e){return e.map((e=>stackFrameWithoutCredentials(e)))}function stackFrameWithoutCredentials(e){const t=e.request.headers["x-algolia-api-key"]?{"x-algolia-api-key":"*****"}:{};return{...e,request:{...e.request,headers:{...e.request.headers,...t}}}}function createTransporter({hosts:e,hostsCache:t,baseHeaders:r,logger:s,baseQueryParameters:a,algoliaAgent:o,timeouts:n,requester:i,requestsCache:c,responsesCache:u}){async function createRetryableOptions(e){const r=await Promise.all(e.map((e=>t.get(e,(()=>Promise.resolve(createStatefulHost(e)))))));const s=r.filter((e=>e.isUp()));const a=r.filter((e=>e.isTimedOut()));const o=[...s,...a];const n=o.length>0?o:e;return{hosts:n,getTimeout(e,t){const r=a.length===0&&e===0?1:a.length+3+e;return r*t}}}async function retryableRequest(c,u,m=true){const h=[];const d=serializeData(c,u);const g=serializeHeaders(r,c.headers,u.headers);const f=c.method==="GET"?{...c.data,...u.data}:{};const p={...a,...c.queryParameters,...f};o.value&&(p["x-algolia-agent"]=o.value);if(u&&u.queryParameters)for(const e of Object.keys(u.queryParameters))u.queryParameters[e]&&Object.prototype.toString.call(u.queryParameters[e])!=="[object Object]"?p[e]=u.queryParameters[e].toString():p[e]=u.queryParameters[e];let v=0;const retry=async(e,r)=>{const a=e.pop();if(a===void 0)throw new l(stackTraceWithoutCredentials(h));const o={...n,...u.timeouts};const f={data:d,headers:g,method:c.method,url:serializeUrl(a,c.path,p),connectTimeout:r(v,o.connect),responseTimeout:r(v,m?o.read:o.write)};const pushToStackTrace=t=>{const r={request:f,response:t,host:a,triesLeft:e.length};h.push(r);return r};const y=await i.send(f);if(isRetryable(y)){const o=pushToStackTrace(y);y.isTimedOut&&v++;s.info("Retryable failure",stackFrameWithoutCredentials(o));await t.set(a,createStatefulHost(a,y.isTimedOut?"timed out":"down"));return retry(e,r)}if(isSuccess(y))return deserializeSuccess(y);pushToStackTrace(y);throw deserializeFailure(y,h)};const y=e.filter((e=>e.accept==="readWrite"||(m?e.accept==="read":e.accept==="write")));const b=await createRetryableOptions(y);return retry([...b.hosts].reverse(),b.getTimeout)}function createRequest(e,t={}){const s=e.useReadTransporter||e.method==="GET";if(!s)return retryableRequest(e,t,s);const createRetryableRequest=()=>retryableRequest(e,t);const o=t.cacheable||e.cacheable;if(o!==true)return createRetryableRequest();const n={request:e,requestOptions:t,transporter:{queryParameters:a,headers:r}};return u.get(n,(()=>c.get(n,(()=>c.set(n,createRetryableRequest()).then((e=>Promise.all([c.delete(n),e])),(e=>Promise.all([c.delete(n),Promise.reject(e)]))).then((([e,t])=>t))))),{miss:e=>u.set(n,e)})}return{hostsCache:t,requester:i,timeouts:n,logger:s,algoliaAgent:o,baseHeaders:r,baseQueryParameters:a,hosts:e,request:createRequest,requestsCache:c,responsesCache:u}}var d={Debug:1,Info:2,Error:3};export{i as AlgoliaError,u as ApiError,e as DEFAULT_CONNECT_TIMEOUT_BROWSER,s as DEFAULT_CONNECT_TIMEOUT_NODE,t as DEFAULT_READ_TIMEOUT_BROWSER,a as DEFAULT_READ_TIMEOUT_NODE,r as DEFAULT_WRITE_TIMEOUT_BROWSER,o as DEFAULT_WRITE_TIMEOUT_NODE,m as DeserializationError,h as DetailedApiError,c as ErrorWithStackTrace,d as LogLevelEnum,l as RetryError,createAlgoliaAgent,createAuth,createBrowserLocalStorageCache,createFallbackableCache,createIterablePromise,createMemoryCache,createNullCache,createNullLogger,createStatefulHost,createTransporter,deserializeFailure,deserializeSuccess,getAlgoliaAgent,isNetworkError,isRetryable,isSuccess,serializeData,serializeHeaders,serializeQueryParameters,serializeUrl,shuffle,stackFrameWithoutCredentials,stackTraceWithoutCredentials};

